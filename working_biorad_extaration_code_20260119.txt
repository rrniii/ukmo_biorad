Working code for vp biorad extraction

import h5py
import shutil

import os
#os.remove('test.h5')
# Specify the file names and the dataset name
#input_file = '/gws/nopw/j04/ncas_radar_vol3/ukmo-nimrod/raw_h5_data/single-site/chenies/2021/20210709_polar_pl_radar05_aggregate.h5'
input_file='/gws/nopw/j04/ncas_radar_vol2/avocet/ukmo-nimrod/raw_h5_data_final/single-site/chenies/2025/20250720_polar_pl_radar05_aggregate.h5'
output_file = '20250720_polar_pl_radar05_aggregate_sp_0000.h5'
group_name = 'sp/1700/'
dataset_name = '1700'

# Open the existing H5 file in read mode
with h5py.File(input_file, 'r') as h5file:
    # Open the output H5 file in append mode ('a' mode ensures that existing data is preserved)
    with h5py.File(output_file, 'w') as new_h5file:

    # Datasets in selected type and time group
    # Access the specific group by name
        group = h5file[group_name]
        # Function to recursively copy datasets to the root level
        def copy_datasets_to_root(group, base_name=""):
            for item_name, item in group.items():
                print('name is:'+item_name)
                print(item)
                full_item_name = f"{base_name}{item_name}"
                if isinstance(item, h5py.Dataset):
                    # Copy dataset to the root of the new file
                    new_h5file.create_dataset(full_item_name, data=item[:])
                elif isinstance(item, h5py.Group):
                    if item_name=='where' or 'what':
                        h5file.copy(h5file[group_name+full_item_name], new_h5file, name=full_item_name)
                        
                    # Recursively copy items in the sub-group, flattening the hierarchy
                    else:
                        copy_datasets_to_root(item, base_name=f"{full_item_name}/")
    
        # Start copying from the specified group
        copy_datasets_to_root(group)

    print(f"Datasets from group '{group_name}' and root attributes have been saved directly to '{output_file}' without the group hierarchy.")